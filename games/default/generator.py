import os
import json
from datetime import datetime

def generate_index():
    base_dir = os.getcwd()
    index_file = os.path.join(base_dir, "index.json")
    script_name = os.path.basename(__file__).lower()
    
    # Definindo o conte√∫do do novo index.json
    index_data = {
        "cache": {
            "backdrop": {"_dirname": "Backdrop", "backdrop": "backdrop.png"},
            "battle": {"_dirname": "Battle"},
            "battle2": {"_dirname": "Battle2"},
            "battlecharset": {"_dirname": "BattleCharSet"},
            "battleweapon": {"_dirname": "BattleWeapon"},
            "charset": {"_dirname": "CharSet", "char": "char.png"},
            "chipset": {"_dirname": "ChipSet", "templatetileset": "templatetileset.png"},
            "faceset": {"_dirname": "FaceSet", "faceset": "faceset.png"},
            "frame": {"_dirname": "Frame"},
            "gameover": {"_dirname": "GameOver"},
            "monster": {"_dirname": "Monster", "monster": "monster.png"},
            "music": {"_dirname": "Music"},
            "panorama": {"_dirname": "Panorama"},
            "picture": {"_dirname": "Picture"},
            "rpg_rt.ini": "RPG_RT.ini",
            "rpg_rt.ldb": "RPG_RT.ldb",
            "rpg_rt.lmt": "RPG_RT.lmt",
            "sound": {"_dirname": "Sound"},
            "system": {"_dirname": "System", "system": "System.png"},
            "system2": {"_dirname": "System2"},
            "title": {"_dirname": "Title"},
            "map0001.lmu": "Map0001.lmu",
            "map0002.lmu": "Map0002.lmu",
            "map0003.lmu": "Map0003.lmu",
            "map0004.lmu": "Map0004.lmu",
            "map0005.lmu": "Map0005.lmu",
            "map0006.lmu": "Map0006.lmu",
            "map0007.lmu": "Map0007.lmu",
            "map0008.lmu": "Map0008.lmu",
            "map0009.lmu": "Map0009.lmu",
            "map0010.lmu": "Map0010.lmu",
            "map0011.lmu": "Map0011.lmu",
            "map0012.lmu": "Map0012.lmu",
            "map0013.lmu": "Map0013.lmu",
            "map0014.lmu": "Map0014.lmu",
            "map0015.lmu": "Map0015.lmu",
            "map0016.lmu": "Map0016.lmu",
            "map0017.lmu": "Map0017.lmu",
            "map0018.lmu": "Map0018.lmu",
            "map0019.lmu": "Map0019.lmu",
            "map0020.lmu": "Map0020.lmu",
            "map0021.lmu": "Map0021.lmu",
            "map0022.lmu": "Map0022.lmu",
            "map0023.lmu": "Map0023.lmu",
            "map0024.lmu": "Map0024.lmu",
            "map0025.lmu": "Map0025.lmu",
            "map0026.lmu": "Map0026.lmu",
            "map0027.lmu": "Map0027.lmu",
            "map0028.lmu": "Map0028.lmu",
            "map0029.lmu": "Map0029.lmu",
            "map0030.lmu": "Map0030.lmu",
            "map0031.lmu": "Map0031.lmu",
            "map0032.lmu": "Map0032.lmu",
            "map0033.lmu": "Map0033.lmu",
            "map0034.lmu": "Map0034.lmu",
            "map0035.lmu": "Map0035.lmu",
            "map0036.lmu": "Map0036.lmu",
            "map0037.lmu": "Map0037.lmu",
            "map0038.lmu": "Map0038.lmu",
            "map0039.lmu": "Map0039.lmu",
            "map0040.lmu": "Map0040.lmu",
            "map0041.lmu": "Map0041.lmu",
            "map0042.lmu": "Map0042.lmu",
            "map0043.lmu": "Map0043.lmu",
            "map0044.lmu": "Map0044.lmu",
            "map0045.lmu": "Map0045.lmu",
            "map0046.lmu": "Map0046.lmu",
            "map0047.lmu": "Map0047.lmu",
            "map0048.lmu": "Map0048.lmu",
            "map0049.lmu": "Map0049.lmu",
            "map0050.lmu": "Map0050.lmu",
            "map0051.lmu": "Map0051.lmu",
            "map0052.lmu": "Map0052.lmu",
            "map0053.lmu": "Map0053.lmu",
            "map0054.lmu": "Map0054.lmu",
            "map0055.lmu": "Map0055.lmu",
            "map0056.lmu": "Map0056.lmu",
            "map0057.lmu": "Map0057.lmu",
            "map0058.lmu": "Map0058.lmu",
            "map0059.lmu": "Map0059.lmu",
            "map0060.lmu": "Map0060.lmu",
            "map0061.lmu": "Map0061.lmu",
            "map0062.lmu": "Map0062.lmu",
            "map0063.lmu": "Map0063.lmu",
            "map0064.lmu": "Map0064.lmu",
            "map0065.lmu": "Map0065.lmu",
            "map0066.lmu": "Map0066.lmu",
            "map0067.lmu": "Map0067.lmu",
            "map0068.lmu": "Map0068.lmu",
            "map0069.lmu": "Map0069.lmu",
            "map0070.lmu": "Map0070.lmu",
            "map0071.lmu": "Map0071.lmu",
            "map0072.lmu": "Map0072.lmu",
            "map0073.lmu": "Map0073.lmu",
            "map0074.lmu": "Map0074.lmu",
            "map0075.lmu": "Map0075.lmu",
            "map0076.lmu": "Map0076.lmu",
            "map0077.lmu": "Map0077.lmu",
            "map0078.lmu": "Map0078.lmu",
            "map0079.lmu": "Map0079.lmu",
            "map0080.lmu": "Map0080.lmu",
            "map0081.lmu": "Map0081.lmu",
            "map0082.lmu": "Map0082.lmu",
            "map0083.lmu": "Map0083.lmu",
            "map0084.lmu": "Map0084.lmu",
            "map0085.lmu": "Map0085.lmu",
            "map0086.lmu": "Map0086.lmu",
            "map0087.lmu": "Map0087.lmu",
            "map0088.lmu": "Map0088.lmu",
            "map0089.lmu": "Map0089.lmu",
            "map0090.lmu": "Map0090.lmu",
            "map0091.lmu": "Map0091.lmu",
            "map0092.lmu": "Map0092.lmu",
            "map0093.lmu": "Map0093.lmu",
            "map0094.lmu": "Map0094.lmu",
            "map0095.lmu": "Map0095.lmu",
            "map0096.lmu": "Map0096.lmu",
            "map0097.lmu": "Map0097.lmu",
            "map0098.lmu": "Map0098.lmu",
            "map0099.lmu": "Map0099.lmu",
            "map0100.lmu": "Map0100.lmu",
            "map0101.lmu": "Map0101.lmu",
            "map0102.lmu": "Map0102.lmu",
            "map0103.lmu": "Map0103.lmu",
            "map0104.lmu": "Map0104.lmu",
            "map0105.lmu": "Map0105.lmu",
            "map0106.lmu": "Map0106.lmu",
            "map0107.lmu": "Map0107.lmu",
            "map0108.lmu": "Map0108.lmu",
            "map0109.lmu": "Map0109.lmu",
            "map0110.lmu": "Map0110.lmu",
            "map0111.lmu": "Map0111.lmu",
            "map0112.lmu": "Map0112.lmu",
            "map0113.lmu": "Map0113.lmu",
            "map0114.lmu": "Map0114.lmu",
            "map0115.lmu": "Map0115.lmu",
            "map0116.lmu": "Map0116.lmu",
            "map0117.lmu": "Map0117.lmu",
            "map0118.lmu": "Map0118.lmu",
            "map0119.lmu": "Map0119.lmu",
            "map0120.lmu": "Map0120.lmu",
            "map0121.lmu": "Map0121.lmu",
            "map0122.lmu": "Map0122.lmu",
            "map0123.lmu": "Map0123.lmu",
            "map0124.lmu": "Map0124.lmu",
            "map0125.lmu": "Map0125.lmu",
            "map0126.lmu": "Map0126.lmu",
            "map0127.lmu": "Map0127.lmu",
            "map0128.lmu": "Map0128.lmu",
            "map0129.lmu": "Map0129.lmu",
            "map0130.lmu": "Map0130.lmu",
            "map0131.lmu": "Map0131.lmu",
            "map0132.lmu": "Map0132.lmu",
            "map0133.lmu": "Map0133.lmu",
            "map0134.lmu": "Map0134.lmu",
            "map0135.lmu": "Map0135.lmu",
            "map0136.lmu": "Map0136.lmu",
            "map0137.lmu": "Map0137.lmu",
            "map0138.lmu": "Map0138.lmu",
            "map0139.lmu": "Map0139.lmu",
            "map0140.lmu": "Map0140.lmu",
            "map0141.lmu": "Map0141.lmu",
            "map0142.lmu": "Map0142.lmu",
            "map0143.lmu": "Map0143.lmu",
            "map0144.lmu": "Map0144.lmu",
            "map0145.lmu": "Map0145.lmu",
            "map0146.lmu": "Map0146.lmu",
            "map0147.lmu": "Map0147.lmu",
            "map0148.lmu": "Map0148.lmu",
            "map0149.lmu": "Map0149.lmu",
            "map0150.lmu": "Map0150.lmu",
            "map0151.lmu": "Map0151.lmu",
            "map0152.lmu": "Map0152.lmu",
            "map0153.lmu": "Map0153.lmu",
            "map0154.lmu": "Map0154.lmu",
            "map0155.lmu": "Map0155.lmu",
            "map0156.lmu": "Map0156.lmu",
            "map0157.lmu": "Map0157.lmu",
            "map0158.lmu": "Map0158.lmu",
            "map0159.lmu": "Map0159.lmu",
            "map0160.lmu": "Map0160.lmu",
            "map0161.lmu": "Map0161.lmu",
            "map0162.lmu": "Map0162.lmu",
            "map0163.lmu": "Map0163.lmu",
            "map0164.lmu": "Map0164.lmu",
            "map0165.lmu": "Map0165.lmu",
            "map0166.lmu": "Map0166.lmu",
            "map0167.lmu": "Map0167.lmu",
            "map0168.lmu": "Map0168.lmu",
            "map0169.lmu": "Map0169.lmu",
            "map0170.lmu": "Map0170.lmu",
            "map0171.lmu": "Map0171.lmu",
            "map0172.lmu": "Map0172.lmu",
            "map0173.lmu": "Map0173.lmu",
            "map0174.lmu": "Map0174.lmu",
            "map0175.lmu": "Map0175.lmu",
            "map0176.lmu": "Map0176.lmu",
            "map0177.lmu": "Map0177.lmu",
            "map0178.lmu": "Map0178.lmu",
            "map0179.lmu": "Map0179.lmu",
            "map0180.lmu": "Map0180.lmu",
            "map0181.lmu": "Map0181.lmu",
            "map0182.lmu": "Map0182.lmu",
            "map0183.lmu": "Map0183.lmu",
            "map0184.lmu": "Map0184.lmu",
            "map0185.lmu": "Map0185.lmu",
            "map0186.lmu": "Map0186.lmu",
            "map0187.lmu": "Map0187.lmu",
            "map0188.lmu": "Map0188.lmu",
            "map0189.lmu": "Map0189.lmu",
            "map0190.lmu": "Map0190.lmu",
            "map0191.lmu": "Map0191.lmu",
            "map0192.lmu": "Map0192.lmu",
            "map0193.lmu": "Map0193.lmu",
            "map0194.lmu": "Map0194.lmu",
            "map0195.lmu": "Map0195.lmu",
            "map0196.lmu": "Map0196.lmu",
            "map0197.lmu": "Map0197.lmu",
            "map0198.lmu": "Map0198.lmu",
            "map0199.lmu": "Map0199.lmu",
            "map0200.lmu": "Map0200.lmu"
        },
        "metadata": {"date": datetime.now().strftime("%Y-%m-%d"), "version": 2}
    }
    
    # Criando o cache de arquivos
    existing_cache = index_data.get("cache", {})
    
    for root, _, files in os.walk(base_dir):
        if root == base_dir:
            continue
        
        dir_name = os.path.basename(root)
        dir_key = dir_name.lower()
        
        if dir_key not in existing_cache:
            existing_cache[dir_key] = {"_dirname": dir_name}
        
        for file in sorted(files, key=str.casefold):
            if file.lower() in {script_name, "index.json"}:
                continue
            
            name_without_ext, _ = os.path.splitext(file)
            name_without_ext = name_without_ext.lower()
            
            if name_without_ext not in existing_cache[dir_key]:
                existing_cache[dir_key][name_without_ext] = file
    
    # Atualizando o cache
    index_data["cache"] = existing_cache
    index_data["metadata"]["date"] = datetime.now().strftime("%Y-%m-%d")
    
    # Criando um novo arquivo index.json
    with open(index_file, "w", encoding="utf-8") as f:
        json.dump(index_data, f, separators=(',', ':'), ensure_ascii=False, sort_keys=False)
    
    print("Arquivo index.json criado com sucesso!")

if __name__ == "__main__":
    generate_index()
